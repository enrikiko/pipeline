pipeline {
   agent any

   environment {
           PATH = "/usr/bin/ansible:/usr/bin/ansible-playbook:$PATH"
           ANS_HOME = tool('ansible')
        }

   stages {
      stage('Deploy DNS') {
         steps {
            echo "Running ${env.BUILD_ID} TAG:${env.BUILD_TAG} on ${env.JENKINS_URL}"
            git 'https://github.com/enrikiko/raspberry'
            sh("pwd")
            sh("ls -ls")
            ansiblePlaybook(
              playbook: 'haproxy.yml',
              inventory: 'inventory/cortijo',
              colorized: true)

         }
      }
   }
   post {
     always {
         cleanWs()
     }
     failure {
         mail bcc: '', body: 'The Pipeline failed :(', cc: '', from: '', replyTo: '', subject: 'The Pipeline failed :(', to: 'enriqueramosmunoz@gmail.com'
     }
   }
}
